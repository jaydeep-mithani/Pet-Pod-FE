name: Branch Policy Check
on:
  pull_request:
    branches: [main, production]

jobs:
  check-branch-policy:
    runs-on: ubuntu-latest
    steps:
      - name: Check branch policy
        run: |
          if [[ "${{ github.base_ref }}" == "production" ]]; then
            if [[ "${{ github.head_ref }}" != "dev" && "${{ github.head_ref }}" != "main" ]]; then
              echo "❌ PRs to production can only be from dev or main branches"
              exit 1
            fi
          elif [[ "${{ github.base_ref }}" == "main" ]]; then
            if [[ "${{ github.head_ref }}" != "production" ]]; then
              echo "❌ PRs to main can only be from production branch"
              exit 1
            fi
          fi
          echo "✅ Branch policy check passed"